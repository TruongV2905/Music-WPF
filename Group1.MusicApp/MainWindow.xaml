<Window x:Class="Group1.MusicApp.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:views="clr-namespace:Group1.MusicApp.Views"
        Title="🎧 Music Player"
        Height="760"
        Width="1267"
        Background="#121212"
        WindowStartupLocation="CenterScreen"
        Loaded="Window_Loaded"
        >

    <!-- ============= THEME / PALETTE (Spotify-like) ============= -->
    <Window.Resources>
        <SolidColorBrush x:Key="BgPrimary" Color="#121212"/>
        <SolidColorBrush x:Key="BgSecondary" Color="#181818"/>
        <SolidColorBrush x:Key="BgCard" Color="#1C1C1C"/>
        <SolidColorBrush x:Key="TextPrimary" Color="#FFFFFF"/>
        <SolidColorBrush x:Key="TextSecondary" Color="#B3B3B3"/>
        <SolidColorBrush x:Key="Accent" Color="#1DB954"/>
        <SolidColorBrush x:Key="Divider" Color="#333333"/>

        <!-- Flat button -->
        <Style x:Key="FlatButton" TargetType="Button">
            <Setter Property="Background" Value="#222"/>
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="BorderBrush" Value="Transparent"/>
            <Setter Property="Padding" Value="8,6"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="FontWeight" Value="SemiBold"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border Background="{TemplateBinding Background}"
                                CornerRadius="6">
                            <ContentPresenter VerticalAlignment="Center" HorizontalAlignment="Center"/>
                        </Border>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
            <Style.Triggers>
                <Trigger Property="IsMouseOver" Value="True">
                    <Setter Property="Background" Value="#2A2A2A"/>
                </Trigger>
                <Trigger Property="IsPressed" Value="True">
                    <Setter Property="Background" Value="#1F1F1F"/>
                </Trigger>
            </Style.Triggers>
        </Style>

        <!-- Play (accent) circle -->
        <Style x:Key="PlayButton" BasedOn="{StaticResource FlatButton}" TargetType="Button">
            <Setter Property="Background" Value="{StaticResource Accent}"/>
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="Width" Value="48"/>
            <Setter Property="Height" Value="48"/>
            <Setter Property="FontSize" Value="16"/>
            <Setter Property="BorderBrush" Value="Transparent"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border Background="{TemplateBinding Background}"
                                CornerRadius="24">
                            <ContentPresenter VerticalAlignment="Center" HorizontalAlignment="Center"/>
                        </Border>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <!-- List item -->
        <Style TargetType="ListViewItem">
            <Setter Property="Foreground" Value="{StaticResource TextPrimary}"/>
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="Padding" Value="6"/>
            <Setter Property="Margin" Value="4"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="ListViewItem">
                        <Border x:Name="Bd" Background="{TemplateBinding Background}" CornerRadius="6">
                            <ContentPresenter/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="Bd" Property="Background" Value="#242424"/>
                            </Trigger>
                            <Trigger Property="IsSelected" Value="True">
                                <Setter TargetName="Bd" Property="Background" Value="#2A2A2A"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>
    </Window.Resources>

    <!-- ============= ROOT LAYOUT ============= -->
    <Grid>
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="240"/>
            <ColumnDefinition Width="*"/>
        </Grid.ColumnDefinitions>
        <Grid.RowDefinitions>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- ============= SIDEBAR ============= -->
        <DockPanel Grid.Column="0" Grid.RowSpan="2" Background="#000000">
            <StackPanel>
                <!-- Logo -->
                <StackPanel Orientation="Horizontal" Margin="20,24,0,20">
                    <TextBlock Text="🎵" FontSize="28" Foreground="{StaticResource Accent}" Margin="0,0,10,0"/>
                    <TextBlock Text="Spotify" FontSize="22" FontWeight="Bold" Foreground="{StaticResource TextPrimary}"/>
                </StackPanel>

                <!-- Nav -->
                <ListBox Background="Transparent"
                         Foreground="{StaticResource TextPrimary}"
                         BorderThickness="0"
                         FontSize="15"
                         Margin="10,0,0,0"
                         Cursor="Hand">
                    <ListBoxItem Content="🏠  Home" Margin="0,6" />
                    <ListBoxItem Content="📚  Your Library" Margin="0,6" Selected="PlaylistMenuItem_Selected"/>
                </ListBox>

                <Separator Margin="15,20,15,10" Background="{StaticResource Divider}" Height="1"/>

                <TextBlock Text="Playlists" Margin="20,0,0,6" Foreground="{StaticResource TextSecondary}"/>
                <ListBox x:Name="lstPlaylist"
                         Background="Transparent"
                         Foreground="{StaticResource TextPrimary}"
                         BorderThickness="0"
                         FontSize="14"
                         Margin="10,0,0,0"
                         Cursor="Hand">
                    <ListBoxItem Content="❤️ My Playlist" Margin="0,5" Selected="PlaylistMenuItem_Selected"/>
                </ListBox>
            </StackPanel>
        </DockPanel>

        <!-- ============= MAIN CONTENT ============= -->
        <Grid Grid.Column="1" Grid.Row="0" Background="{StaticResource BgPrimary}" Margin="16,16,16,8">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="*"/>
            </Grid.RowDefinitions>
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="2*"/>
                <ColumnDefinition Width="*"/>
            </Grid.ColumnDefinitions>

            <!-- Search bar: giữ underline tím (vẽ tay), căn giữa hoàn hảo -->
            <Grid Grid.Row="0" Grid.ColumnSpan="2" Margin="0,0,0,14" Height="44">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <!-- Search box -->
                <Border Grid.Column="0"
                        Background="#1A1A1A"
                        BorderBrush="{StaticResource Divider}"
                        BorderThickness="1"
                        CornerRadius="10"
                        Padding="12,0">
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="26"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>

                        <TextBlock Text="🔍"
                                   Grid.Column="0"
                                   VerticalAlignment="Center"
                                   Foreground="{StaticResource TextSecondary}"
                                   Opacity="0.9"/>

                        <!-- Vùng nhập + underline tím -->
                        <Grid Grid.Column="1">
                            <Grid.RowDefinitions>
                                <RowDefinition Height="*"/>
                                <RowDefinition Height="2"/>
                            </Grid.RowDefinitions>

                            <TextBox x:Name="txtSearch"
                                     Grid.Row="0"
                                     Background="Transparent"
                                     BorderThickness="0"
                                     Foreground="{StaticResource TextPrimary}"
                                     CaretBrush="{StaticResource TextPrimary}"
                                     FontSize="15"
                                     Padding="0"
                                     VerticalContentAlignment="Center"
                                     TextAlignment="Left"
                                     KeyDown="txtSearch_KeyDown"
                                     ToolTip="Tìm bài hát hoặc ca sĩ..."/>
                        </Grid>
                    </Grid>
                </Border>

                <!-- Search button cùng chiều cao -->
                <Button x:Name="btnSearch"
                        Grid.Column="1"
                        Content="Search"
                        Style="{StaticResource FlatButton}"
                        Background="{StaticResource Accent}"
                        Margin="10,0,0,0"
                        Height="44"
                        MinWidth="110"
                        Click="btnSearch_Click"/>
            </Grid>

            <!-- Track list card -->
            <Border x:Name="SearchResultsContainer"
                    Grid.Row="1"
                    Grid.Column="0"
                    Background="{StaticResource BgSecondary}"
                    CornerRadius="10"
                    Padding="10"
                    Margin="0,0,10,0">
                <ListView x:Name="lstTracks"
                          Foreground="{StaticResource TextPrimary}"
                          Background="#191919"
                          BorderThickness="0"
                          SelectionChanged="lstTracks_SelectionChanged"
                          ScrollViewer.VerticalScrollBarVisibility="Auto"
                          HorizontalContentAlignment="Stretch"
                          PreviewMouseLeftButtonDown="lstTracks_PreviewMouseLeftButtonDown">
                    <ListView.ItemTemplate>
                        <DataTemplate>
                            <Grid Margin="5">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>

                                <Image Width="56"
                                       Height="56"
                                       Margin="0,0,10,0"
                                       Stretch="UniformToFill"
                                       VerticalAlignment="Center"
                                       Source="{Binding AlbumImageUrl}"/>

                                <StackPanel Grid.Column="1" VerticalAlignment="Center">
                                    <TextBlock Text="{Binding Name}" FontWeight="Bold" FontSize="14"/>
                                    <TextBlock Text="{Binding ArtistName}" FontSize="12" Foreground="{StaticResource TextSecondary}"/>
                                </StackPanel>

                                <!-- Detail Button -->
                                <Button Grid.Column="2"
                                        Content="ℹ️"
                                        Width="36"
                                        Height="36"
                                        Style="{StaticResource FlatButton}"
                                        Click="btnTrackDetail_Click"
                                        PreviewMouseDown="btnTrackDetail_PreviewMouseDown"
                                        Tag="{Binding}"
                                        ToolTip="Chi tiết bài hát"/>
                            </Grid>
                        </DataTemplate>
                    </ListView.ItemTemplate>
                </ListView>
            </Border>

            <!-- Playlist View -->
            <views:PlaylistView x:Name="PlaylistViewControl"
                                Grid.Row="1"
                                Grid.Column="0"
                                Visibility="Collapsed"/>

            <!-- Now Playing + Lyrics -->
            <Border Grid.Row="1"
                    Background="{StaticResource BgSecondary}"
                    CornerRadius="10"
                    Padding="16" Grid.ColumnSpan="2" Margin="663,0,-31,0">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="10"/>
                        <RowDefinition Height="*"/>
                    </Grid.RowDefinitions>

                    <!-- Now Playing header -->
                    <Grid Grid.Row="0">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>

                        <Image x:Name="imgCover"
                               Width="88"
                               Height="88"
                               Grid.Column="0"
                               Stretch="UniformToFill"
                               Margin="0,0,12,0"
                               VerticalAlignment="Center"/>

                        <StackPanel Grid.Column="1" VerticalAlignment="Center" Margin="0,0,4,0">
                            <TextBlock x:Name="lblNowPlaying"
                                       Text="Chưa chọn bài"
                                       Foreground="{StaticResource TextPrimary}"
                                       FontSize="18"
                                       FontWeight="Bold"
                                       TextTrimming="CharacterEllipsis"
                                       MaxWidth="340" Width="284" Height="33" RenderTransformOrigin="0.05,0.852"/>
                            <TextBlock x:Name="lblArtist"
                                       Text=""
                                       Foreground="{StaticResource TextSecondary}"
                                       FontSize="14"
                                       TextTrimming="CharacterEllipsis"
                                       MaxWidth="340"/>
                        </StackPanel>
                    </Grid>

                    <Border Grid.Row="1" Height="10" Background="Transparent"/>

                    <!-- Lyrics plain text (scroll) -->
                    <Border Grid.Row="2" Background="#101010" CornerRadius="8" Padding="16">
                        <Grid>
                            <ScrollViewer x:Name="svPlainLyrics"
                                          VerticalScrollBarVisibility="Auto"
                                          PanningMode="VerticalFirst"
                                          VerticalAlignment="Stretch">
                                <TextBlock x:Name="txtLyrics"
                                           Foreground="#EDEDED"
                                           FontSize="18"
                                           TextWrapping="Wrap"
                                           LineHeight="30"
                                           TextAlignment="Center"
                                           FontWeight="Medium"
                                           Opacity="0.95"
                                           Text="🎶 Chưa có lời bài hát..."/>
                            </ScrollViewer>

                            <ScrollViewer x:Name="svLyrics"
                                          Visibility="Collapsed"
                                          VerticalScrollBarVisibility="Auto">
                                <StackPanel>
                                    <TextBlock Text="Lyrics sync area"
                                               Foreground="Gray"
                                               HorizontalAlignment="Center"
                                               Margin="8"/>
                                </StackPanel>
                            </ScrollViewer>
                        </Grid>
                    </Border>
                </Grid>
            </Border>
        </Grid>

        <!-- ============= BOTTOM PLAYER (ẩn khi chưa chọn bài) ============= -->
        <Border x:Name="BottomPlayerBar"
                Grid.Column="1" Grid.Row="1"
                Background="#181818"
                Padding="10,8"
                BorderBrush="{StaticResource Divider}"
                BorderThickness="1,1,1,0"
                Visibility="Collapsed"
                Panel.ZIndex="100">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="2*"/>
                    <ColumnDefinition Width="*"/>
                </Grid.ColumnDefinitions>

                <!-- Hidden MediaElement (engine) -->
                <MediaElement x:Name="mediaPlayer"
                              LoadedBehavior="Manual"
                              UnloadedBehavior="Manual"
                              Volume="0.8"
                              Visibility="Collapsed"/>

                <!-- Left: tiny cover + titles -->
                <StackPanel Grid.Column="0" Orientation="Horizontal" VerticalAlignment="Center">
                    <Image Width="44" Height="44" Source="{Binding ElementName=imgCover, Path=Source}"
                           Stretch="UniformToFill" Margin="0,0,10,0"/>
                    <StackPanel>
                        <TextBlock Text="{Binding ElementName=lblNowPlaying, Path=Text}"
                                   Foreground="{StaticResource TextPrimary}"
                                   FontWeight="SemiBold"
                                   FontSize="14"
                                   TextTrimming="CharacterEllipsis" MaxWidth="260"/>
                        <TextBlock Text="{Binding ElementName=lblArtist, Path=Text}"
                                   Foreground="{StaticResource TextSecondary}"
                                   FontSize="12"
                                   TextTrimming="CharacterEllipsis" MaxWidth="260"/>
                    </StackPanel>
                </StackPanel>

                <!-- Center: controls + progress -->
                <StackPanel Grid.Column="1" VerticalAlignment="Center">
                    <StackPanel Orientation="Horizontal" HorizontalAlignment="Center" Margin="0,0,0,6">
                        <Button x:Name="btnPrev" Content="⏮" Width="40" Height="40" Margin="6,0"
                                Style="{StaticResource FlatButton}" Click="btnPrev_Click" ToolTip="Previous"/>
                        <Button x:Name="btnPlayPause" Content="▶" Margin="6,0"
                                Style="{StaticResource PlayButton}" Click="btnPlayPause_Click" ToolTip="Play"/>
                        <Button x:Name="btnNext" Content="⏭" Width="40" Height="40" Margin="6,0"
                                Style="{StaticResource FlatButton}" Click="btnNext_Click" ToolTip="Next"/>
                    </StackPanel>

                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="40"/>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="40"/>
                        </Grid.ColumnDefinitions>

                        <TextBlock x:Name="lblElapsed" Grid.Column="0"
                                   Text="0:00" Foreground="{StaticResource TextSecondary}"
                                   VerticalAlignment="Center" HorizontalAlignment="Left" FontSize="12" />

                        <ProgressBar x:Name="progressPreview"
                                     Grid.Column="1"
                                     Height="5"
                                     Minimum="0"
                                     Maximum="30"
                                     Value="0"
                                     Foreground="{StaticResource Accent}"
                                     Background="{StaticResource Divider}"
                                     Margin="8,0"/>

                        <TextBlock x:Name="lblTotal" Grid.Column="2"
                                   Text="0:30" Foreground="{StaticResource TextSecondary}"
                                   VerticalAlignment="Center" HorizontalAlignment="Right" FontSize="12"/>
                    </Grid>
                </StackPanel>

                <!-- Right: volume (cân giữa) -->
                <Grid Grid.Column="2" VerticalAlignment="Center" HorizontalAlignment="Right" Height="40">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="44"/>
                        <ColumnDefinition Width="44"/>
                        <ColumnDefinition Width="160"/>
                    </Grid.ColumnDefinitions>

                    <!-- Detail Button for Now Playing -->
                    <Button x:Name="btnNowPlayingDetail"
                            Grid.Column="0"
                            Content="ℹ️"
                            Width="40"
                            Height="40"
                            Style="{StaticResource FlatButton}"
                            Background="#222"
                            Click="btnNowPlayingDetail_Click"
                            ToolTip="Chi tiết bài hát đang phát"/>

                    <Button x:Name="btnVolume"
                            Grid.Column="1"
                            Width="40" Height="40"
                            Style="{StaticResource FlatButton}"
                            Background="#222"
                            Click="btnVolume_Click"
                            ToolTip="Mute">
                        <TextBlock Text="🔊" FontSize="16" VerticalAlignment="Center" HorizontalAlignment="Center"/>
                    </Button>

                    <Slider x:Name="sldVolume"
                            Grid.Column="2"
                            Margin="10,0,0,0"
                            VerticalAlignment="Center"
                            Minimum="0" Maximum="100" Value="80"
                            ValueChanged="sldVolume_ValueChanged"/>
                </Grid>
            </Grid>
        </Border>

        <!-- ============= TRACK DETAIL OVERLAY ============= -->
        <Grid x:Name="TrackDetailOverlay"
              Grid.Column="1" Grid.ColumnSpan="2" Grid.RowSpan="2"
              Visibility="Collapsed"
              Background="#99000000"
              Panel.ZIndex="50"
              MouseDown="DetailOverlay_MouseDown">
            <Grid.RenderTransform>
                <TranslateTransform x:Name="DetailTransform" Y="0"/>
            </Grid.RenderTransform>

            <!-- Close Button -->
            <Button x:Name="btnCloseDetail"
                    Content="✕"
                    Width="48"
                    Height="48"
                    Style="{StaticResource FlatButton}"
                    Background="#333"
                    FontSize="20"
                    HorizontalAlignment="Right"
                    VerticalAlignment="Top"
                    Margin="0,20,20,0"
                    Click="btnCloseDetail_Click"
                    ToolTip="Đóng (ESC)"/>

            <!-- Detail Content -->
            <Border MaxWidth="850"
                    MaxHeight="650"
                    Background="Transparent"
                    MouseDown="DetailContent_MouseDown">
                <views:TrackDetailView x:Name="TrackDetailViewControl"/>
            </Border>
        </Grid>
    </Grid>
</Window>
